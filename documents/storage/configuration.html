<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Storage">

    <link rel="shortcut icon" href="/assets/images/favicon.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <title>Storage - Contiv</title>

    <link href="/assets/stylesheets/application-2b39eabd.css" rel="stylesheet"/>

    <!--[if lt IE 9]><script src="/assets/javascripts/html5shiv-ccddc50c.js"></script><script src="/assets/javascripts/respond.min-1eb35b04.js"></script><![endif]-->

    
  </head>

  <body id="page-Storage" class=" page-Storage layout-documents page-sub">

<div id="header" class="navbar-static-top">
  <div class="container">
    <div class="row">
      
        <div class="navbar-header">
          <div class="navbar-brand">
              <a class="logo" href="/">Contiv</a>
            </a>
          </div>
          
        </div>
        <div class="buttons hidden-xs">
          <nav role="navigation">
            <ul class="main-links nav navbar-nav navbar-left">
              <li class="first li-under"><a href="/documents/index.html">Documentation</a></li>
              <li class="li-under"><a href="/articles/index.html">Articles</a></li>
              <li class="li-under"><a href="https://github.com/contiv" target="_blank">
                        GitHub
                        <i class="fa fa-github fa-lg"></i>
                        </a></li>
                    <li class="li-under"><a href="https://contiv-slack.herokuapp.com" target="_blank">
                        Slack
                        <i class="fa fa-slack fa-lg"></i>
                        </a></li>
                    <li><a href="https://twitter.com/projectcontiv" target="_blank">
                        Twitter
                        <i class="fa fa-twitter fa-lg"></i>
                        </a></li>
            </ul>
          </nav>
        </div>
      
    </div>
  </div>
</div>


<div class="sidebar-overlay"></div>


<aside id="sidebar" class="sidebar sidebar-default sidebar-fixed-right" role="navigation">
    
    <div class="sidebar-header header-cover">
        
        <div class="sidebar-image">
            <img src="/assets/images/logo3-a96fcb82.png" width="49px" height="56px">
        </div>
    </div>

    
    <ul class="main nav sidebar-nav">
        <li class="first"><a href="/intro/index.html">Intro</a></li>
        <li class=""><a href="/docs/index.html">Docs</a></li>
    </ul>
    <div class="divider"></div>
    
    <ul class="external nav sidebar-nav">
        <li class=""><a class="v-btn gray sml" href="https://github.com/contiv"><svg id="svg-download" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;">
  <style>
  </style>
  <path class="" d="M13,0H1C0.5,0,0,0.5,0,1v12c0,0.5,0.5,1,1,1h4.7c0,0,0,0,0-0.1c0-0.2,0-0.6,0-1.1c-1.8,0.4-2.2-0.9-2.2-0.9
    c-0.3-0.8-0.7-1-0.7-1c-0.6-0.4,0-0.4,0-0.4c0.7,0,1,0.7,1,0.7c0.6,1,1.5,0.7,1.9,0.5c0.1-0.4,0.2-0.7,0.4-0.9c-1.5-0.2-3-0.7-3-3.2
    c0-0.7,0.3-1.3,0.7-1.8C3.7,5.8,3.5,5.1,3.9,4.2c0,0,0.6-0.2,1.8,0.7c0.5-0.1,1.1-0.2,1.6-0.2c0.6,0,1.1,0.1,1.6,0.2
    c1.3-0.8,1.8-0.7,1.8-0.7c0.4,0.9,0.1,1.6,0.1,1.7c0.4,0.5,0.7,1,0.7,1.8c0,2.5-1.5,3.1-3,3.2C8.7,11.1,9,11.5,9,12.1
    c0,0.9,0,1.6,0,1.8c0,0,0,0,0,0.1h4c0.5,0,1-0.5,1-1V1C14,0.5,13.5,0,13,0z"/>
</svg>
GitHub</a></li>
    </ul>
</aside>


<div class="container">
	<div class="row">
		<div class="col-md-3 col-sm-3 col-xs-12">
					<div class="docs-sidebar hidden-print affix-top" role="complementary">
			<hr>
			<h3>User Guide</h3>
			<ul class="nav docs-sidenav">
				<li>
					<a href="/documents/gettingStarted/index.html">Getting Started</a>
					<ul class="nav">
						<li>
							<a class="hasChildren" href="/documents/gettingStarted/networking/index.html">Networking</a>
							<ul class="nav">
								<li>
									<a class="hasChildren" href="/documents/gettingStarted/networking/index.html#UsingVagrant">Single Machine</a>
									<ul class="subnav">
										<li>
												<a href="/documents/gettingStarted/networking/swarm.html">Docker Swarm</a>
										</li>
										<li>
												<a href="/documents/gettingStarted/networking/k8s.html">Kubernetes</a>
										</li>
										<li>
												<a href="/documents/gettingStarted/networking/mesos.html">Mesos</a>
										</li>
										<li>
												<a href="/documents/gettingStarted/networking/nomad.html">Nomad</a>
										</li>
									</ul>
								</li>
								<li>
									<a class="hasChildren" href="/documents/gettingStarted/networking/index.html#WithNetworkedServers">Multiple Servers</a>
									<ul class="subnav">
										<li>
												<a href="/documents/gettingStarted/networking/install-swarm.html">Docker Swarm</a>
										</li>
										<li>
												<a href="/documents/gettingStarted/networking/install-k8s.html">Kubernetes</a>
										</li>
										<li>
												<a href="/documents/gettingStarted/networking/bgp.html">BGP</a>
										</li>
										<li>
												<a href="/documents/gettingStarted/networking/aci.html">Cisco ACI</a>
										</li>
									</ul>
								</li>
							</ul>
						</li>
						<li>
							<a href="/documents/gettingStarted/storage/storage.html">Storage </a>
						</li>
						<li>
							<a class="hasChildren" href="/documents/gettingStarted/cluster/index.html">Cluster </a>
							<ul class="subnav">
								<li>
										<a href="/documents/gettingStarted/cluster/vagrant.html">Single Machine</a>
								</li>
								<li>
										<a href="/documents/gettingStarted/cluster/baremetal.html">Multiple Servers</a>
								</li>
							</ul>
						</li>
					</ul>
				</li>
				<li>
					<a href="/documents/networking/index.html">Networking</a>
					<ul class="nav">
						<li>
								<a href="/documents/networking/concepts.html">Concepts and Terminology</a>
						</li>
						<li>
								<a href="/documents/networking/policies.html">Policies</a>
						</li>
						<li>
								<a href="/documents/networking/services.html">Service Routing</a>
						</li>
						<li>
								<a class="hasChildren" href="/documents/networking/physical-networks.html">Physical Networks</a>
								<ul class="nav">
									<li>
											<a href="/documents/networking/bgp.html">L3 Routed Networks</a>
									</li>
									<li>
											<a href="/documents/networking/l2-vlan.html">L2 Bridged Networks</a>
									</li>
									<li>
											<a href="/documents/networking/aci_ug.html">Cisco ACI</a>
									</li>
								</ul>
						</li>
						<li>
								<a href="/documents/networking/ipam.html">IPAM and Service Discovery</a>
						</li>
						<li>
								<a href="/documents/networking/ipv6.html">IPv6</a>
						</li>
					</ul>
				</li>
				<li class="active">
					<a href="/documents/storage/index.html">Storage</a>
					<ul class="nav">
						<li>
								<a href="/documents/storage/architecture.html">Architecture</a>
						</li>
						<li class="active">
								<a href="/documents/storage/configuration.html">Configuration</a>
						</li>
						<li>
								<a href="/documents/storage/containers.html">Creating a container with a volume</a>
						</li>
						<li>
								<a href="/documents/storage/volcli.html">Volcli Reference</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/documents/cluster/index.html">Cluster</a>
					<ul class="nav">
						<li>
								<a href="/documents/cluster/concepts.html">Concepts and Terminology</a>
						</li>
						<li>
								<a href="/documents/cluster/node-lifecycle.html">Node Lifecycle Management</a>
						</li>
					</ul>
				</li>
			</ul>
			<hr><p>
			<h3>Tutorials and Talks</h3>
				<ul class="nav docs-sidenav">
					<li>
						<a href="/documents/tutorials/index.html">Tutorials</a>
						<ul class="nav">
							<li>
									<a href="/documents/tutorials/container-101.html">Container Networking Tutorial</a>
							</li>
							<li>
									<a href="/documents/tutorials/contiv-compose.html">Policies with Networking</a>
							</li>
						</ul>
					</li>
					<li>
						<a href="/documents/demos/index.html">Demonstration Videos</a>
					</li>
					<li>
						<a href="/documents/talks/index.html">Community Talks</a>
					</li>
				</ul>
			<hr><p>
			<h3>Examples</h3>
				<ul class="nav docs-sidenav">
					<ul class="subnav">
						<li>
							<a href="/documents/samples/index.html">Docker Compose Examples</a>
						</li>
						<li>
							<a href="/documents/samples/index.html">Kubernetes Examples</a>
						</li>
						<li>
							<a href="/documents/samples/mcast.html">Multicast Examples</a>
						</li>
						<li>
							<a href="/documents/samples/nomad.html">Nomad Examples</a>
						</li>
					</ul>
				</ul>
			<hr><p>
			<h3>Reference</h3>
				<ul class="nav docs-sidenav">
					<ul class="subnav">
						<li><a href="https://godoc.org/github.com/contiv/contivmodel/client" target="_blank">Network API Reference</a><br></li>
						<li><a href="https://godoc.org/github.com/contiv/volplugin/config" target="_blank">Storage API Reference</a><br></li>
						<li><a href="https://godoc.org/github.com/contiv/cluster" target="_blank">Cluster API Reference</a><br></li>
					</ul>
				</ul>
			<hr><p>
		</div>

		</div>  
		<div id="main-content" class="col-sm-9 col-md-9 col-xs-12" role="main">
			<div class="bs-docs-section">
				
	<h2>Configuration</h2>
<p>This section describes various ways to manipulate volplugin through
configuration and options.</p>

<h3>Volume Formatting</h3>
<p>Because of limitations in the docker volume implementation, we use a <em>pattern</em>
to describe volumes to docker. This pattern is <code>policy-name/volume-name</code>, and
is supplied to <code>docker volume create --name</code> and transfers to <code>docker run -v</code>.</p>
<p>For example, a typical use of volplugin might work like this presuming we have
a policy uploaded named <code>policy1</code>:</p>
<pre class="highlight plaintext"><code>$ docker volume create -d volplugin --name policy1/foo
$ docker run -it -v policy1/foo:/mnt ubuntu bash
</code></pre>
<p>This pattern creates a volume called <code>foo</code> in <code>policy1</code>&#39;s default ceph pool. If
you wish to change the pool (or other options), see &quot;Driver Options&quot; below.</p>

<h3>JSON Global Configuration</h3>
<p>Global configuration modifies the whole system through the apiserver, volplugin
and volsupervisor systems. You can manipulate them with the <code>volcli global</code>
command set.</p>
<p>A global configuration looks like this:</p>
<pre class="highlight javascript"><code><span class="p">{</span>
  <span class="s2">"TTL"</span><span class="err">:</span> <span class="mi">60</span><span class="p">,</span>
  <span class="s2">"Debug"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">"Timeout"</span><span class="err">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="s2">"MountPath"</span><span class="err">:</span> <span class="s2">"/mnt/ceph"</span>
<span class="p">}</span>
</code></pre>
<p>Options:</p>

<ul>
<li>TTL: time (in seconds) for a mount record to timeout in the event a volplugin dies
</li>
<li>Debug: boolean value indicating whether or not to enable debug traps/logging
</li>
<li>Timeout: time (in minutes) for a command to be terminated if it exceeds this value
</li>
<li>MountPath: the base path used for mount directories. Directories will be in
<a name="policy_volume"/><a href="#policy_volume"><code>policy/volume</code></a> format off this root.
</li>
</ul>

<h3>JSON Tenant Configuration</h3>
<p>Tenant configuration uses JSON to configure the default volume parameters such
as what pool to use. It is uploaded to etcd by the <code>volcli</code> tool.</p>
<p>Here is an example:</p>
<pre class="highlight javascript"><code><span class="p">{</span>
  <span class="s2">"backends"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"crud"</span><span class="err">:</span> <span class="s2">"ceph"</span><span class="p">,</span>
    <span class="s2">"mount"</span><span class="err">:</span> <span class="s2">"ceph"</span><span class="p">,</span>
    <span class="s2">"snapshot"</span><span class="err">:</span> <span class="s2">"ceph"</span>
  <span class="p">},</span>
  <span class="s2">"unlocked"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="s2">"driver"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"pool"</span><span class="err">:</span> <span class="s2">"rbd"</span>
  <span class="p">},</span>
  <span class="s2">"create"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"size"</span><span class="err">:</span> <span class="s2">"10MB"</span><span class="p">,</span>
    <span class="s2">"filesystem"</span><span class="err">:</span> <span class="s2">"btrfs"</span>
  <span class="p">},</span>
  <span class="s2">"runtime"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"snapshots"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">"snapshot"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"frequency"</span><span class="err">:</span> <span class="s2">"30m"</span><span class="p">,</span>
      <span class="s2">"keep"</span><span class="err">:</span> <span class="mi">20</span>
    <span class="p">},</span>
    <span class="s2">"rate-limit"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"write-iops"</span><span class="err">:</span> <span class="mi">1000</span><span class="p">,</span>
      <span class="s2">"read-iops"</span><span class="err">:</span> <span class="mi">1000</span><span class="p">,</span>
      <span class="s2">"write-bps"</span><span class="err">:</span> <span class="mi">100000000</span><span class="p">,</span>
      <span class="s2">"read-bps"</span><span class="err">:</span> <span class="mi">100000000</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">"filesystems"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"ext4"</span><span class="err">:</span> <span class="s2">"mkfs.ext4 -m0 %"</span><span class="p">,</span>
    <span class="s2">"btrfs"</span><span class="err">:</span> <span class="s2">"mkfs.btrfs %"</span><span class="p">,</span>
    <span class="s2">"falsefs"</span><span class="err">:</span> <span class="s2">"/bin/false"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Let&#39;s go through what these parameters mean.</p>

<ul>
<li><a name="unlocked"/><a href="#unlocked"><code>unlocked</code></a>: removes the exclusive locks between mounts for a given volume.

<ul>
<li>This is a protective measure and is <em>not needed</em> to use NFS, so this flag
will turn it off (by setting it to true) if desired for a given policy.
</li>
</ul>
</li>
<li><code>filesystems</code>: a policy-level map of filesystem name -&gt; mkfs command.

<ul>
<li>Commands are run when the filesystem is specified and the volume has not
been created already.
</li>
<li>Commands run in a POSIX (not bash, zsh) shell.
</li>
<li>If the <a name="filesystems"/><a href="#filesystems"><code>filesystems</code></a> block is omitted, <code>mkfs.ext4 -m0 %</code> will be applied to
all volumes within this policy.
</li>
<li>Referred to by the volume create-time parameter <a name="filesystem"/><a href="#filesystem"><code>filesystem</code></a>. Note that you
can use a <code>%</code> to be replaced with the device to format.
</li>
</ul>
</li>
<li><code>backends</code>: the storage backends to use for different operations. Note that
not all drivers are compatible with each other. This is still an area with
work being done on it. Ceph and NFS are supported as <code>mount</code> options, <code>crud</code>
and <code>snapshot</code> operations require Ceph for now. Both driver names are lower-case.

<ul>
<li><a name="crud"/><a href="#crud"><code>crud</code></a>: Create/Delete operations driver name
</li>
<li><a name="mount"/><a href="#mount"><code>mount</code></a>: Mount operations driver name
</li>
<li><a name="snapshot"/><a href="#snapshot"><code>snapshot</code></a>: Snapshot operations
</li>
</ul>
</li>
<li><code>driver</code>: driver-specific options.

<ul>
<li><a name="pool"/><a href="#pool"><code>pool</code></a>: the ceph pool to use
</li>
</ul>
</li>
<li><code>create</code>: create-time options.

<ul>
<li><a name="size"/><a href="#size"><code>size</code></a>: the size of the volume
</li>
<li><a name="filesystem"/><a href="#filesystem"><code>filesystem</code></a>: the filesystem to use, see <code>filesystems</code> above.
</li>
</ul>
</li>
<li><code>runtime</code>: runtime options. These options can be changed and the changes will
be applied to mounted volumes almost immediately.

<ul>
<li><a name="snapshots"/><a href="#snapshots"><code>snapshots</code></a>: use the snapshots feature
</li>
<li><a name="snapshot"/><a href="#snapshot"><code>snapshot</code></a>: map of the following parameters:
</li>
<li><a name="frequency"/><a href="#frequency"><code>frequency</code></a>: the amount of time between taking snapshots.
</li>
<li><a name="keep"/><a href="#keep"><code>keep</code></a>: the number of snapshots to keep. the oldest ones will be deleted first.
</li>
<li><a name="rate_limit"/><a href="#rate_limit"><code>rate-limit</code></a>: map of the following rate-limiting parameters:
</li>
<li><a name="write_iops"/><a href="#write_iops"><code>write-iops</code></a>: Write I/O weight
</li>
<li><a name="read_iops"/><a href="#read_iops"><code>read-iops</code></a>: Read I/O weight
</li>
<li><a name="write_bps"/><a href="#write_bps"><code>write-bps</code></a>: Write bytes/s
</li>
<li><a name="read_bps"/><a href="#read_bps"><code>read-bps</code></a>: Read bytes/s
</li>
</ul>
</li>
</ul>
<p>You supply them with <code>volcli policy upload &lt;policy name&gt;</code>. The JSON itself is
provided via standard input, so for example if your file is <code>policy2.json</code>:</p>
<pre class="highlight plaintext"><code>$ volcli policy upload myTenant &lt; policy2.json
</code></pre>

<h3>Driver Options</h3>
<p>Driver options are passed at <code>docker volume create</code> time with the <code>--opt</code> flag.
They are <code>key=value</code> pairs and are specified as such, f.e.:</p>
<pre class="highlight plaintext"><code>docker volume create -d volplugin \
  --name policy2/image \
  --opt size=1000
</code></pre>
<p>The options are as follows:</p>

<ul>
<li><a name="size"/><a href="#size"><code>size</code></a>: the size (in MB) for the volume.
</li>
<li><code>snapshots</code>: take snapshots or not. Affects future options with <code>snapshot</code> in the key name.

<ul>
<li>the value must satisfy <a href="https://golang.org/pkg/strconv/#ParseBool">this specification</a>
</li>
</ul>
</li>
<li><a name="snapshots_frequency"/><a href="#snapshots_frequency"><code>snapshots.frequency</code></a>: as above in the previous chapter, the frequency which we
take snapshots.
</li>
<li><a name="snapshots_keep"/><a href="#snapshots_keep"><code>snapshots.keep</code></a>: as above in the previous chapter, the number of snapshots to keep.
</li>
<li><a name="filesystem"/><a href="#filesystem"><code>filesystem</code></a>: the named filesystem to create. See the JSON Configuration
section for more information on this.
</li>
<li><a name="rate_limit_write_iops"/><a href="#rate_limit_write_iops"><code>rate-limit.write.iops</code></a>: Write IOPS
</li>
<li><a name="rate_limit_read_iops"/><a href="#rate_limit_read_iops"><code>rate-limit.read.iops</code></a>: Read IOPS
</li>
<li><a name="rate_limit_read_bps"/><a href="#rate_limit_read_bps"><code>rate-limit.read.bps</code></a>: Read b/s
</li>
<li><a name="rate_limit_write_bps"/><a href="#rate_limit_write_bps"><code>rate-limit.write.bps</code></a>: Write b/s
</li>
</ul>

<h3>NFS Support</h3>
<p>NFS support is still limited (at the time of this writing). To use the NFS
support in its current state you must take a few steps.</p>

<ol>
<li>Ensure &quot;nfs&quot; is the &quot;mount&quot; backend for your policy. <a name="crud"/><a href="#crud"><code>crud</code></a> and <code>snapshot</code>
should be empty.
</li>
<li><p>Create your volume with the remote mount path specified at create time:</p>
<pre class="highlight plaintext"><code>docker volume create -d volplugin --name mypolicy/myvolume --opt mount=127.0.0.1:/mynfsmount
</code></pre>
</li>
<li><p>Mount and continue as normally.</p>
</li>
</ol>


			</div>
		</div>
	</div>
</div>