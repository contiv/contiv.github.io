<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Physical network integration">

    <link rel="shortcut icon" href="/assets/images/favicon.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <title>Physical network integration - Contiv</title>

    <link href="/assets/stylesheets/application-ffbab1f8.css" rel="stylesheet"/>

    <!--[if lt IE 9]><script src="/assets/javascripts/html5shiv-099439cc.js"></script><script src="/assets/javascripts/respond.min-1eb35b04.js"></script><![endif]-->

    
  </head>

  <body id="page-Physical network integration" class=" page-Physical network integration layout-documents page-sub">

  <div class="navbar-jumbotron">
    <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/" style="color:$white"><img src="/assets/images/contivicon4-fb7a06d8.png" height="32px" width="32px" alt="Contiv logo"></a>
        </div>
        <div class="collapse navbar-collapse" id="navbar">
          <ul class="nav navbar-nav navbar-right main-nav">
            <li><a href="/documents/">Docs</a></li>
            <li><a href="https://github.com/contiv/install/releases" target="_blank">Download</a></li>
             <li><a href="/documents/support/index.html">Support</a></li>
            <li><a href="http://blogs.cisco.com/tag/contiv" target="_blank">Blog</a></li>
            
            <li><a href="https://github.com/contiv" target="_blank"><i class="fa fa-github"></i></a></li>
            <li><a href="https://contiv.herokuapp.com/" target="_blank"><i class="fa fa-slack"></i></a></li>
          </ul>
        </div>
      </div>
    </nav>
  </div>


<div class="sidebar-overlay"></div>


<aside id="sidebar" class="sidebar sidebar-default sidebar-fixed-right" role="navigation">
    
    <div class="sidebar-header header-cover">
        
        <div class="sidebar-image">
            <img src="/assets/images/logo3-a96fcb82.png" width="49px" height="56px">
        </div>
    </div>

    
    <ul class="main nav sidebar-nav">
        <li class="first"><a href="/intro/index.html">Intro</a></li>
        <li class=""><a href="/docs/index.html">Docs</a></li>
    </ul>
    <div class="divider"></div>
    
    <ul class="external nav sidebar-nav">
        <li class=""><a class="v-btn gray sml" href="https://github.com/contiv"><svg id="svg-download" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;">
  <style>
  </style>
  <path class="" d="M13,0H1C0.5,0,0,0.5,0,1v12c0,0.5,0.5,1,1,1h4.7c0,0,0,0,0-0.1c0-0.2,0-0.6,0-1.1c-1.8,0.4-2.2-0.9-2.2-0.9
    c-0.3-0.8-0.7-1-0.7-1c-0.6-0.4,0-0.4,0-0.4c0.7,0,1,0.7,1,0.7c0.6,1,1.5,0.7,1.9,0.5c0.1-0.4,0.2-0.7,0.4-0.9c-1.5-0.2-3-0.7-3-3.2
    c0-0.7,0.3-1.3,0.7-1.8C3.7,5.8,3.5,5.1,3.9,4.2c0,0,0.6-0.2,1.8,0.7c0.5-0.1,1.1-0.2,1.6-0.2c0.6,0,1.1,0.1,1.6,0.2
    c1.3-0.8,1.8-0.7,1.8-0.7c0.4,0.9,0.1,1.6,0.1,1.7c0.4,0.5,0.7,1,0.7,1.8c0,2.5-1.5,3.1-3,3.2C8.7,11.1,9,11.5,9,12.1
    c0,0.9,0,1.6,0,1.8c0,0,0,0,0,0.1h4c0.5,0,1-0.5,1-1V1C14,0.5,13.5,0,13,0z"/>
</svg>
GitHub</a></li>
    </ul>
</aside>


<div class="container">
	<div class="row">
		<div class="col-md-3 col-sm-3 col-xs-12">
					<div class="docs-sidebar hidden-print affix-top" role="complementary">
			<hr>
			<h3>Release Notes</h3>
			<ul class="nav">
				<li>
					<a href="/documents/releasenotes/v11x.html">1.1.x</a>
					<a href="/documents/releasenotes/v10x.html">1.0.x</a>
				</li>
			</ul>
			<hr>
			<h3>Getting Started</h3>
							<ul class="nav">
							<li>
								<a href="/documents/gettingStarted/">Intro</a>
						    </li>
							<li>
								<a href="/documents/networking/features.html">Features</a>
						    </li>
								<li>
									<a href="https://github.com/contiv/install/blob/master/README.md">Installation</a>
									</li>
						    <li>
								<a href="/documents/networking/">Contiv Networking Concepts</a>
						    </li>
								</ul>
									<hr>
			<h3>Admin Guide</h3>
			<ul class="nav">
				<li>
					<a href="/documents/admin/index.html">Intro</a>
				</li>
				<li>
				    <a href="/documents/admin/createTenant.html">Managing Tenants</a>
				</li>
				<li>
				    <a href="/documents/admin/manageUsers.html">Managing Users</a>
			    </li>		
			    <li>
				    <a href="/documents/admin/manageAuthorizations.html">Managing Authorizations</a>
			    </li>
			    <li>
				    <a href="/documents/admin/createNodes.html">Managing Nodes</a>
			    </li>
			     <li>
				    <a href="/documents/admin/manageNetworks.html">Managing Networks</a>
			    </li>
			    <li>
				    <a href="/documents/admin/manageLDAP.html">Managing LDAP</a>
			    </li>
			</ul>
				</li>
			</ul>
			<hr>
			<h3>User Guide</h3>
						
					<ul class="nav">
						<li>
								<a href="/documents/networking/policies.html">Policies</a>
						</li>
						<li>
								<a href="/documents/networking/services.html">Service Loadbalancing</a>
						</li>
						<li class="active">
								<a class="hasChildren" href="/documents/networking/physical-networks.html">Physical Networks</a>
								<ul class="nav">
									<li class="active">
											<a href="/documents/networking/bgp.html">L3 Routed Networks</a>
									</li>
									<li>
											<a href="/documents/networking/l2-vlan.html">L2 Bridged Networks</a>
									</li>
									<li>
											<a href="/documents/networking/aci_ug.html">Cisco ACI</a>
									</li>
								</ul>
						</li>
						<li>
								<a href="/documents/networking/ipam.html">IPAM and Service Discovery</a>
						</li>
						<li>
								<a href="/documents/networking/ipv6.html">IPv6</a>
						</li>
					</ul>
				</li>
				
				
			</ul>
			<hr><p>
			<h3>Tutorials and Talks</h3>
				<ul class="nav">
					<li>
						<a href="/documents/tutorials/index.html">Tutorials</a>
					</li>
					<li>
						<a href="/documents/demos/index.html">Demonstration Videos</a>
					</li>
					<li>
						<a href="/documents/talks/index.html">Community Talks</a>
					</li>
				</ul>
			<hr><p>
			<h3>OpenShift</h3>
				<ul class="nav">
						<li>
							<a href="/documents/openshift/index.html">Contiv and OpenShift</a>
						</li>
				</ul>
			<hr><p>
			<h3>Examples</h3>
				<ul class="nav">
						</li>
						<li>
							<a href="/documents/samples/mcast.html">Multicast Examples</a>
						</li>
				</ul>
				<hr><p>
			<h3>Community</h3>
				<ul class="nav">
						</li>
						<li>
							<a href="/documents/community/index.html">Engagement</a>
							<a href="/documents/community/examples.html">Community Resources </a>
						</li>
				</ul>
			<hr><p>
			<h3>Reference</h3>
				<ul class="nav">
					    <li>
					    <a href="/documents/api/wip.html" target="_blank">API Reference</a>
					    </li> 
					    <li>
					    <a href="/documents/reference/netctlcli.html" target="_blank">CLI Reference</a>
					    </li> 
						<li><a href="https://godoc.org/github.com/contiv/contivmodel/client" target="_blank">Go Client Library</a>
						</li>
						
				</ul>
			<hr><p>
		</div>

		</div>  
		<div id="main-content" class="col-sm-9 col-md-9 col-xs-12" role="main">
			<div class="bs-docs-section">
					<h1>Contiv in ACI Mode</h1>
<p>Contiv works with Cisco Application Centric Infrastructure (ACI) for policy enforcement and connectivity. At the same time, Contiv maintains a consistent interface with the container ecosystem. Contiv interacts with the APIC via an ACI gateway (ACI-GW) to create the objects and associations that enable containers to communicate according to the policy intent.</p>
<p><img alt="ACI" src="/assets/images/aci-integration-69edd79c.png"/></p>

<h2>UI Configuration</h2>
<p>As a Contiv admin, you can set up ACI as your network default.</p>
<p>See <a href="/documents/admin/manageNetworks.html">Managing Networks</a>.</p>

<h2>CLI Configuration</h2>
<p>Configuration in ACI mode can be split into the following three categories:</p>
<p>1. Network resource allocation for your Contiv cluster<br>
2. External policy configuration<br>
3. Application policy configuration<br></p>

<h3>Network Resource Allocation for Your Contiv Cluster</h3>
<p>Contiv uses the static VLAN binding mechanism to integrate with ACI. This mechanism requires a physDom, VLAN pool, and some associated objects. For a step-by-step guide to this configuration see <a href="/documents/networking/aci_setup.html">Installing Contiv Network with Cisco ACI</a>.</p>
<p>After the ACI is configured, Contiv must be configured using the <code>netctl</code> command as follows:</p>
<pre class="highlight plaintext"><code>netctl global set --fabric-mode aci --vlan-range 400-500
</code></pre>
<p>Note: The VLAN range must match the VLAN pool you create in APIC. The range in this example is 400-500.</p>

<h3>External Policy Configuration</h3>
<p>External policy configuration determines how containers in the cluster communicate with endpoints that are outside the container cluster. These endpoints may include VMs, physical servers or endpoints external to the fabric itself. The main ACI objects of interest from this perspective are: tenants, bridge domains (BDs), and contracts.</p>

<h4>Tenant Configuration</h4>
<p>In most scenarios, the ACI admin wants to pre-create a tenant in the APIC. This gives the tenant the ability to span the container cluster as well as other network endpoints. Tenants are identified by their name in both ACI and Contiv. In order to refer to a tenant that exists in ACI, you can create the same tenant in Contiv using the Contiv Network CLI.</p>
<p>For example, the following command creates a tenant in Contiv:</p>
<pre class="highlight plaintext"><code>netctl tenant create MixedTenant
</code></pre>
<p>If the tenant does not already exist in ACI, it is created for you when an application profile is pushed to the ACI as described below.</p>

<h4>Bridge Domain Configuration</h4>
<p>Contiv does not have an explicit BD object. Because ACI requires a BD object, the ACI-GW creates it in ACI when a network is associated with ACI with an app profile binding.</p>
<p>Some use cases might require binding to a BD that already exists in ACI. To bind with an existing BD, the BD&#39;s domain name (DN) must be passed to the ACI-GW via the <code>APIC_EPG_BRIDGE_DOMAIN</code> environment variable when the ACI-GW is started. See <a href="/documents/networking/aci_setup.html">Installing Contiv Network with Cisco ACI</a>.</p>

<h4>Contracts</h4>
<p>For communication between the Contiv cluster and external endpoints, corresponding contracts are necessary. Such a contract must first be created in ACI, then its DN must be supplied to Contiv by creating an external-contracts object in Contiv.</p>
<p>An external-contracts object in Contiv contains a set of contracts that can be either consumed or provided by a container application.</p>
<p>In the following example, <em>ToConsume</em> specifies a contract that can be consumed by an application tier and <em>ToProvide</em> specifies a set of contracts that must be provided by an application tier. Application tiers are specified by <em>groups</em> (equivalent to EPGs in ACI) within Contiv.</p>
<pre class="highlight plaintext"><code>netctl external-contracts  create -t MixedTenant -c -a "uni/tn-MixedTenant/brc-allowicmp" ToConsume
netctl external-contracts  create -t MixedTenant -p -a "uni/tn-MixedTenant/brc-allowicmp" -a "uni/tn-MixedTenant/brc-allowtcp8080" ToProvide
</code></pre>
<p>A set of external contracts can be associated with a group using the netctl group create command:</p>
<pre class="highlight plaintext"><code>netctl group create -t MixedTenant -e ToConsume net1 QueryApp
</code></pre>

<h3>Application Policy Configuration</h3>
<p>Contiv uses a group-based policy like ACI. Each of the application tiers must have an endpoint group associated with a network before policy can be applied to it.</p>

<h4>Create a Network</h4>
<p>You create a network using the <code>netctl</code> command:</p>
<pre class="highlight plaintext"><code>netctl net create -t MixedTenant -e vlan -s 66.1.1.0/24 -g 66.1.1.254 net1
</code></pre>
<p>Contiv uses the network object to allocate IP addresses to containers. Therefore, even if you pre-create a BD, you must still create a network object. If you would like to reserve a part of the subnet for allocation to external endpoints, you can provide part of the subnet to Contiv.</p>
<p>For example:</p>
<pre class="highlight plaintext"><code>netctl net create -t MixedTenant -e vlan -s 66.1.1.20-44/24 -g 66.1.1.254 net1
</code></pre>
<p>If you pre-created the BD, the <code>-g</code> argument matches the BD&#39;s gateway.</p>

<h4>Create a Policy</h4>
<p>To apply a policy, create a policy object. You can add rules to the policy after EPGs are created.</p>
<pre class="highlight plaintext"><code>netctl policy create -t MixedTenant app2db
</code></pre>

<h4>Create Endpoint Groups</h4>
<p>Depending on the composition of the application, one more EPG must be created in Contiv. Typically, you create an EPG for each tier of the application.</p>
<p>In the following example , the <em>db</em> tier specifies only an internal policy. The <em>app</em> tier specifies a set of external contracts in addition to the internal policy.</p>
<pre class="highlight plaintext"><code>netctl group create -t MixedTenant -p app2db net1 db
netctl group create -t MixedTenant -e ToConsume -e ToProvide -p app2db net1 app
</code></pre>

<h4>Add Rules to the Policy</h4>
<p>Specify policy between tiers by adding rules to the policy you created. You can add multiple rules to the same policy.</p>
<p>For example, the following rule opens TCP port 6379 from <em>app</em> to <em>db</em>.</p>
<pre class="highlight plaintext"><code>netctl policy rule-add -t MixedTenant -d in --protocol tcp --port 6379 --from-group app --action allow app2db 1
</code></pre>

<h4>Create an Application Profile</h4>
<p>The application profile is the point of policy integration between Contiv and ACI. It is when an application profile is created that the corresponding objects get pushed to ACI.</p>
<p>The following command results in an application profile being created under MixedTenant in the ACI with EPGs <code>app</code> and <code>db</code>. All associated policy objects are also created.</p>
<pre class="highlight plaintext"><code>netctl app-profile create -t MixedTenant -g app,db container-profile
</code></pre>

<h3>Create Containers</h3>
<p>You can now use Docker commands (or other orchestration tools) to create containers. If you are using Docker, use the <code>--net</code> option to specify the Docker network name that corresponds to the application tier (use <code>docker network ls | grep app</code> to find the network name that corresponds to <code>app</code> in the example). For Kubernetes, specify the tenant, network, and endpoint group using the <code>io.contiv.tenant</code>, <code>io.contiv.network</code>, and <code>io.contiv.net-group</code> labels respectively.</p>

	<hr>

			</div>
		</div>
	</div>
</div>


<div class="row">
    <div class="col-md-10 col-md-offset-1">
        <hr>
            <p style="text-align: center"><font color="black">Copyright &copy; 2017 Cisco and/or its affiliates. All rights reserved.</font>
            </p>
    </div>
</div>