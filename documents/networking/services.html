<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Service Routing">

    <link rel="shortcut icon" href="/assets/images/favicon.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <title>Service Routing - Contiv</title>

    <link href="/assets/stylesheets/application-ffbab1f8.css" rel="stylesheet"/>

    <!--[if lt IE 9]><script src="/assets/javascripts/html5shiv-099439cc.js"></script><script src="/assets/javascripts/respond.min-1eb35b04.js"></script><![endif]-->

    
  </head>

  <body id="page-Service Routing" class=" page-Service Routing layout-documents page-sub">

  <div class="navbar-jumbotron">
    <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/" style="color:$white"><img src="/assets/images/contivicon4-fb7a06d8.png" height="32px" width="32px" alt="Contiv logo"></a>
        </div>
        <div class="collapse navbar-collapse" id="navbar">
          <ul class="nav navbar-nav navbar-right main-nav">
            <li><a href="/documents/">Docs</a></li>
            <li><a href="https://github.com/contiv/install/releases" target="_blank">Download</a></li>
             <li><a href="/documents/support/index.html">Support</a></li>
            <li><a href="http://blogs.cisco.com/tag/contiv" target="_blank">Blog</a></li>
            
            <li><a href="https://github.com/contiv" target="_blank"><i class="fa fa-github"></i></a></li>
            <li><a href="https://contiv.herokuapp.com/" target="_blank"><i class="fa fa-slack"></i></a></li>
          </ul>
        </div>
      </div>
    </nav>
  </div>


<div class="sidebar-overlay"></div>


<aside id="sidebar" class="sidebar sidebar-default sidebar-fixed-right" role="navigation">
    
    <div class="sidebar-header header-cover">
        
        <div class="sidebar-image">
            <img src="/assets/images/logo3-a96fcb82.png" width="49px" height="56px">
        </div>
    </div>

    
    <ul class="main nav sidebar-nav">
        <li class="first"><a href="/intro/index.html">Intro</a></li>
        <li class=""><a href="/docs/index.html">Docs</a></li>
    </ul>
    <div class="divider"></div>
    
    <ul class="external nav sidebar-nav">
        <li class=""><a class="v-btn gray sml" href="https://github.com/contiv"><svg id="svg-download" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;">
  <style>
  </style>
  <path class="" d="M13,0H1C0.5,0,0,0.5,0,1v12c0,0.5,0.5,1,1,1h4.7c0,0,0,0,0-0.1c0-0.2,0-0.6,0-1.1c-1.8,0.4-2.2-0.9-2.2-0.9
    c-0.3-0.8-0.7-1-0.7-1c-0.6-0.4,0-0.4,0-0.4c0.7,0,1,0.7,1,0.7c0.6,1,1.5,0.7,1.9,0.5c0.1-0.4,0.2-0.7,0.4-0.9c-1.5-0.2-3-0.7-3-3.2
    c0-0.7,0.3-1.3,0.7-1.8C3.7,5.8,3.5,5.1,3.9,4.2c0,0,0.6-0.2,1.8,0.7c0.5-0.1,1.1-0.2,1.6-0.2c0.6,0,1.1,0.1,1.6,0.2
    c1.3-0.8,1.8-0.7,1.8-0.7c0.4,0.9,0.1,1.6,0.1,1.7c0.4,0.5,0.7,1,0.7,1.8c0,2.5-1.5,3.1-3,3.2C8.7,11.1,9,11.5,9,12.1
    c0,0.9,0,1.6,0,1.8c0,0,0,0,0,0.1h4c0.5,0,1-0.5,1-1V1C14,0.5,13.5,0,13,0z"/>
</svg>
GitHub</a></li>
    </ul>
</aside>


<div class="container">
	<div class="row">
		<div class="col-md-3 col-sm-3 col-xs-12">
					<div class="docs-sidebar hidden-print affix-top" role="complementary">
			<hr>
			<h3>Release Notes</h3>
			<ul class="nav">
				<li>
					<a href="/documents/releasenotes/v11x.html">1.1.x</a>
					<a href="/documents/releasenotes/v10x.html">1.0.x</a>
				</li>
			</ul>
			<hr>
			<h3>Getting Started</h3>
							<ul class="nav">
							<li>
								<a href="/documents/gettingStarted/">Intro</a>
						    </li>
							<li>
								<a href="/documents/networking/features.html">Features</a>
						    </li>
								<li>
									<a href="https://github.com/contiv/install/blob/master/README.md">Installation</a>
									</li>
						    <li>
								<a href="/documents/networking/">Contiv Networking Concepts</a>
						    </li>
								</ul>
									<hr>
			<h3>Admin Guide</h3>
			<ul class="nav">
				<li>
					<a href="/documents/admin/index.html">Intro</a>
				</li>
				<li>
				    <a href="/documents/admin/createTenant.html">Managing Tenants</a>
				</li>
				<li>
				    <a href="/documents/admin/manageUsers.html">Managing Users</a>
			    </li>		
			    <li>
				    <a href="/documents/admin/manageAuthorizations.html">Managing Authorizations</a>
			    </li>
			    <li>
				    <a href="/documents/admin/createNodes.html">Managing Nodes</a>
			    </li>
			     <li>
				    <a href="/documents/admin/manageNetworks.html">Managing Networks</a>
			    </li>
			    <li>
				    <a href="/documents/admin/manageLDAP.html">Managing LDAP</a>
			    </li>
			</ul>
				</li>
			</ul>
			<hr>
			<h3>User Guide</h3>
						
					<ul class="nav">
						<li>
								<a href="/documents/networking/policies.html">Policies</a>
						</li>
						<li class="active">
								<a href="/documents/networking/services.html">Service Loadbalancing</a>
						</li>
						<li>
								<a class="hasChildren" href="/documents/networking/physical-networks.html">Physical Networks</a>
								<ul class="nav">
									<li>
											<a href="/documents/networking/bgp.html">L3 Routed Networks</a>
									</li>
									<li>
											<a href="/documents/networking/l2-vlan.html">L2 Bridged Networks</a>
									</li>
									<li>
											<a href="/documents/networking/aci_ug.html">Cisco ACI</a>
									</li>
								</ul>
						</li>
						<li>
								<a href="/documents/networking/ipam.html">IPAM and Service Discovery</a>
						</li>
						<li>
								<a href="/documents/networking/ipv6.html">IPv6</a>
						</li>
					</ul>
				</li>
				
				
			</ul>
			<hr><p>
			<h3>Tutorials and Talks</h3>
				<ul class="nav">
					<li>
						<a href="/documents/tutorials/index.html">Tutorials</a>
					</li>
					<li>
						<a href="/documents/demos/index.html">Demonstration Videos</a>
					</li>
					<li>
						<a href="/documents/talks/index.html">Community Talks</a>
					</li>
				</ul>
			<hr><p>
			<h3>OpenShift</h3>
				<ul class="nav">
						<li>
							<a href="/documents/openshift/index.html">Contiv and OpenShift</a>
						</li>
				</ul>
			<hr><p>
			<h3>Examples</h3>
				<ul class="nav">
						</li>
						<li>
							<a href="/documents/samples/mcast.html">Multicast Examples</a>
						</li>
				</ul>
				<hr><p>
			<h3>Community</h3>
				<ul class="nav">
						</li>
						<li>
							<a href="/documents/community/index.html">Contiv Community Examples </a>
						</li>
				</ul>
			<hr><p>
			<h3>Reference</h3>
				<ul class="nav">
					    <li>
					    <a href="/documents/api/wip.html" target="_blank">API Reference</a>
					    </li> 
					    <li>
					    <a href="/documents/reference/netctlcli.html" target="_blank">CLI Reference</a>
					    </li> 
						<li><a href="https://godoc.org/github.com/contiv/contivmodel/client" target="_blank">Go Client Library</a>
						</li>
						
				</ul>
			<hr><p>
		</div>

		</div>  
		<div id="main-content" class="col-sm-9 col-md-9 col-xs-12" role="main">
			<div class="bs-docs-section">
					<h1>Service Load Balancing</h1>
<p>A service provides network connection on a set of ports to a cluster of  containers matching the service label selector.</p>
<p>Services offer:</p>

<ul>
<li>Easy scaling up and down. 
</li>
<li>Efficient load balancing.
</li>
<li>Minimal downtime.
</li>
</ul>
<p>A provider is one or more containers that match the label selector associated with the services.
 <strong>Note</strong>: This feature would be deprecated since docker 1.12 onward service load balancer feature  is supported natively by docker swarm.</p>

<h2>Defining Services</h2>
<p>After you create your network, you can define services using the UI, the <code>netctl</code> command line interface (CLI), or the Contiv Network REST APIs, but it is recommended
to use the UI or API to take advantage of the authentication and authorization options in those interfaces.</p>
<p><strong>Note</strong>: Service requirements are defined by <em>selectors</em>. Selectors are key-value pairs 
that group providers with matching labels.</p>

<h3>To create a Service Load Balancer using netctl:</h3>
<p>1. Create network as net0-2 in default tenant</p>
<pre class="highlight plaintext"><code>netctl network create net0-2 -s 10.0.0.0/24 -g 10.0.0.254 -encap vxlan -t default
</code></pre>
<p>2. Create service network as svc-net-2-0 in default tenant</p>
<pre class="highlight plaintext"><code>netctl network create svc-net-2-0 -s 30.2.0.0/24 -g 30.2.0.254 -encap vxlan -t default
</code></pre>
<p>3. Create service on service network as svc-0-default in default tenant</p>
<pre class="highlight plaintext"><code>netctl service create svc-0-default --network svc-net-2-0 -t default --selector=key0=value1 --selector=key1=value2 --selector=key2=value3 --selector=key3=value4 --port=80:8080:TCP --port=643:7070:UDP
</code></pre>
<p>4. Verify service name and its IPs.</p>
<pre class="highlight plaintext"><code>[vagrant@netplugin-node1 ~]$ netctl service ls
ServiceName    Tenant    Network      Selectors
---------      --------  -------      -------
svc-0-default  default   svc-net-1-0  [key0=value1 key1=value2 key2=value3 key3=value4]

[vagrant@netplugin-node1 ~]$ netctl service inspect svc-0-default
----
----
       "labels": "map[key0:value1 key1:value2 key2:value3 key3:value4]",
       "macAddress": "02:02:0a:00:00:08",
       "network": "net0-1.default",
       "serviceName": "svc-0-default"
      }
    ],
    "serviceVip": "30.1.0.1" 
  }
</code></pre>
<p>4. Create four service containers in network net0-2</p>
<pre class="highlight plaintext"><code>docker run -itd --name=net0-2-srv0-0-0 --net=net0-2  contiv/alpine  sleep 600m
docker run -itd --name=net0-2-srv1-1-1 --net=net0-2  contiv/alpine  sleep 600m
docker run -itd --name=net0-2-srv2-2-2 --net=net0-2  contiv/alpine  sleep 600m
docker run -itd --name=net0-2-srv3-0-3 --net=net0-2  contiv/alpine  sleep 600m
</code></pre>
<p>5. Similarly create  provider containers as service backend containers</p>
<pre class="highlight plaintext"><code>docker run -itd --name=srv-default-net0-2-20-3 --net=net0-2  --label=key0=value1 --label=key1=value2 --label=key2=value3 --label=key3=value4  contiv/alpine sleep 600m
docker run -itd --name=srv-default-net0-2-21-1 --net=net0-2  --label=key0=value1 --label=key1=value2 --label=key2=value3 --label=key3=value4  contiv/alpine sleep 600m
docker run -itd --name=srv-default-net0-2-22-2 --net=net0-2  --label=key0=value1 --label=key1=value2 --label=key2=value3 --label=key3=value4  contiv/alpine sleep 600m
docker run -itd --name=srv-default-net0-2-23-0 --net=net0-2  --label=key0=value1 --label=key1=value2 --label=key2=value3 --label=key3=value4  contiv/alpine sleep 600m
</code></pre>
<p>6. Run Service  instances on provider containers(TCP server at ports 8080 and 7070) i.e Use netcat utility to run server</p>
<pre class="highlight plaintext"><code>docker exec -it srv-default-net0-2-20-3  nc -lk -p 7070 -e /bin/true &amp;
docker exec -it srv-default-net0-2-21-1  nc -lk -p 7070 -e /bin/true &amp;
docker exec -it srv-default-net0-2-22-2  nc -lk -p 7070 -e /bin/true &amp;
docker exec -it srv-default-net0-2-23-0  nc -lk -p 7070 -e /bin/true &amp;
docker exec -it srv-default-net0-2-20-3  nc -lk -p 8080 -e /bin/true &amp;
docker exec -it srv-default-net0-2-21-1  nc -lk -p 8080 -e /bin/true &amp;
docker exec -it srv-default-net0-2-22-2  nc -lk -p 8080 -e /bin/true &amp;
docker exec -it srv-default-net0-2-23-0  nc -lk -p 8080 -e /bin/true &amp; 
</code></pre>
<p>7. login into service conatiners and connect to service  i.e Use netcat utility to run client to connect service</p>
<pre class="highlight plaintext"><code>docker exec -it net0-2-srv1-1-1  nc -z -n -v -w 1  30.2.0.1 80
docker exec -it net0-2-srv3-0-3  nc -z -n -v -w 1  30.2.0.1 80
docker exec -it net0-2-srv2-2-2  nc -z -n -v -w 1  30.2.0.1 80
docker exec -it net0-2-srv0-0-0  nc -z -n -v -w 1  30.2.0.1 80
</code></pre>

<h3>To create a Service Load Balancer using the UI:</h3>
<p>1. From <em>Service Load Balancer</em>, click <em>Create Service Load Balanacer</em>. 
<img alt="service" src="/documents/networking/CreateServiceLoadBalancer-22ae2b28.png"/><br>
   The Create Service Load Balancer page displays.<br>
<img alt="createservice" src="/documents/networking/CreateServiceLoadBalancer-22ae2b28.png"/><br>
2. Choose a name for the service load balancer. <br>
3. Select the tenant.<br>
4. Select the network. <br>
5. Enter the <em>Service IP</em> address.<br>
6. Under <em>Label Selectors</em> choose you label name and value.<br>
7. Choose your <em>Service</em> and <em>Provider</em> ports and your <em>Protocol</em>.<br>
8. Click <em>Create</em>.<br></p>
<p>To create a Service Load Balancer, using the CLI, run:</p>
<pre class="highlight plaintext"><code>netctl net create [$SERVICE_NAME] -s [$SERVICE_IP_ADDRESS]

netctl service create [$APP_SERVICE_NAME] --network [$NETWORK_NAME] --tenant [$TENANT_NAME] selector=[$selector1] --selector=[$selector2] --selector=[$selector3] --port [$SERVICE_PORT]:[$PROVIDER_PORT]:[$PROTOCOL]
</code></pre>
<p>For example, to create a web service in a web tier for which providers must be stable and production-ready:</p>
<pre class="highlight plaintext"><code>netctl net create contiv-srv-net -s 100.1.1.0/24

netctl service create app-svc --network contiv-srv-net --tenant default --selector=tier=web --selector=release=stable --selector=environment=prod --port 8080:80:TCP
</code></pre>


	<hr>

			</div>
		</div>
	</div>
</div>


<div class="row">
    <div class="col-md-10 col-md-offset-1">
        <hr>
            <p style="text-align: center"><font color="black">Copyright &copy; 2017 Cisco and/or its affiliates. All rights reserved.</font>
            </p>
    </div>
</div>