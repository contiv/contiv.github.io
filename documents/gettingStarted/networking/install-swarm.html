<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Setting up a Swarm Cluster.">

    <link rel="shortcut icon" href="/assets/images/favicon.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <title>Swarm Cluster - Contiv</title>

    <link href="/assets/stylesheets/application-2b39eabd.css" rel="stylesheet"/>

    <!--[if lt IE 9]><script src="/assets/javascripts/html5shiv-099439cc.js"></script><script src="/assets/javascripts/respond.min-1eb35b04.js"></script><![endif]-->

    
  </head>

  <body id="page-Swarm Cluster" class=" page-Swarm Cluster layout-documents page-sub">

<div id="header" class="navbar-static-top">
  <div class="container">
    <div class="row">
      
        <div class="navbar-header">
          <div class="navbar-brand">
              <a class="logo" href="/">Contiv</a>
            </a>
          </div>
          
        </div>
        <div class="buttons hidden-xs">
          <nav role="navigation">
            <ul class="main-links nav navbar-nav navbar-left">
              <li class="first li-under"><a href="/documents/index.html">Documentation</a></li>
              <li class="li-under"><a href="/articles/index.html">Articles</a></li>
              <li class="li-under"><a href="https://github.com/contiv" target="_blank">
                        GitHub
                        <i class="fa fa-github fa-lg"></i>
                        </a></li>
                    <li class="li-under"><a href="https://contiv.herokuapp.com" target="_blank">
                        Slack
                        <i class="fa fa-slack fa-lg"></i>
                        </a></li>
                    <li><a href="https://twitter.com/projectcontiv" target="_blank">
                        Twitter
                        <i class="fa fa-twitter fa-lg"></i>
                        </a></li>
            </ul>
          </nav>
        </div>
      
    </div>
  </div>
</div>


<div class="sidebar-overlay"></div>


<aside id="sidebar" class="sidebar sidebar-default sidebar-fixed-right" role="navigation">
    
    <div class="sidebar-header header-cover">
        
        <div class="sidebar-image">
            <img src="/assets/images/logo3-a96fcb82.png" width="49px" height="56px">
        </div>
    </div>

    
    <ul class="main nav sidebar-nav">
        <li class="first"><a href="/intro/index.html">Intro</a></li>
        <li class=""><a href="/docs/index.html">Docs</a></li>
    </ul>
    <div class="divider"></div>
    
    <ul class="external nav sidebar-nav">
        <li class=""><a class="v-btn gray sml" href="https://github.com/contiv"><svg id="svg-download" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;">
  <style>
  </style>
  <path class="" d="M13,0H1C0.5,0,0,0.5,0,1v12c0,0.5,0.5,1,1,1h4.7c0,0,0,0,0-0.1c0-0.2,0-0.6,0-1.1c-1.8,0.4-2.2-0.9-2.2-0.9
    c-0.3-0.8-0.7-1-0.7-1c-0.6-0.4,0-0.4,0-0.4c0.7,0,1,0.7,1,0.7c0.6,1,1.5,0.7,1.9,0.5c0.1-0.4,0.2-0.7,0.4-0.9c-1.5-0.2-3-0.7-3-3.2
    c0-0.7,0.3-1.3,0.7-1.8C3.7,5.8,3.5,5.1,3.9,4.2c0,0,0.6-0.2,1.8,0.7c0.5-0.1,1.1-0.2,1.6-0.2c0.6,0,1.1,0.1,1.6,0.2
    c1.3-0.8,1.8-0.7,1.8-0.7c0.4,0.9,0.1,1.6,0.1,1.7c0.4,0.5,0.7,1,0.7,1.8c0,2.5-1.5,3.1-3,3.2C8.7,11.1,9,11.5,9,12.1
    c0,0.9,0,1.6,0,1.8c0,0,0,0,0,0.1h4c0.5,0,1-0.5,1-1V1C14,0.5,13.5,0,13,0z"/>
</svg>
GitHub</a></li>
    </ul>
</aside>


<div class="container">
	<div class="row">
		<div class="col-md-3 col-sm-3 col-xs-12">
					<div class="docs-sidebar hidden-print affix-top" role="complementary">
			<hr>
			<h3>User Guide</h3>
			<ul class="nav docs-sidenav">
				<li class="active">
					<a href="/documents/gettingStarted/index.html">Getting Started</a>
					<ul class="nav">
						<li class="active">
							<a class="hasChildren" href="/documents/gettingStarted/networking/index.html">Networking</a>
							<ul class="nav">
								<li>
									<a class="hasChildren" href="/documents/gettingStarted/networking/index.html#UsingVagrant">Single Machine</a>
									<ul class="subnav">
										<li>
												<a href="/documents/gettingStarted/networking/swarm.html">Docker Swarm</a>
										</li>
										<li>
												<a href="/documents/gettingStarted/networking/k8s.html">Kubernetes</a>
										</li>
										<li>
												<a href="/documents/gettingStarted/networking/mesos.html">Mesos</a>
										</li>
										<li>
												<a href="/documents/gettingStarted/networking/nomad.html">Nomad</a>
										</li>
									</ul>
								</li>
								<li class="active">
									<a class="hasChildren" href="/documents/gettingStarted/networking/index.html#WithNetworkedServers">Multiple Servers</a>
									<ul class="subnav">
										<li class="active">
												<a href="/documents/gettingStarted/networking/install-swarm.html">Docker Swarm</a>
										</li>
										<li>
												<a href="/documents/gettingStarted/networking/install-k8s.html">Kubernetes</a>
										</li>
										<li>
												<a href="/documents/gettingStarted/networking/bgp.html">BGP</a>
										</li>
										<li>
												<a href="/documents/gettingStarted/networking/aci.html">Cisco ACI</a>
										</li>
									</ul>
								</li>
							</ul>
						</li>
						<li>
							<a href="/documents/gettingStarted/storage/storage.html">Storage </a>
						</li>
						<li>
							<a class="hasChildren" href="/documents/gettingStarted/cluster/index.html">Cluster </a>
							<ul class="subnav">
								<li>
										<a href="/documents/gettingStarted/cluster/vagrant.html">Single Machine</a>
								</li>
								<li>
										<a href="/documents/gettingStarted/cluster/baremetal.html">Multiple Servers</a>
								</li>
							</ul>
						</li>
					</ul>
				</li>
				<li>
					<a href="/documents/networking/index.html">Networking</a>
					<ul class="nav">
						<li>
								<a href="/documents/networking/features.html">Features</a>
						</li>
						<li>
								<a href="/documents/networking/concepts.html">Concepts and Terminology</a>
						</li>
						<li>
								<a href="/documents/networking/policies.html">Policies</a>
						</li>
						<li>
								<a href="/documents/networking/services.html">Service Loadbalancing</a>
						</li>
						<li>
								<a class="hasChildren" href="/documents/networking/physical-networks.html">Physical Networks</a>
								<ul class="nav">
									<li>
											<a href="/documents/networking/bgp.html">L3 Routed Networks</a>
									</li>
									<li>
											<a href="/documents/networking/l2-vlan.html">L2 Bridged Networks</a>
									</li>
									<li>
											<a href="/documents/networking/aci_ug.html">Cisco ACI</a>
									</li>
								</ul>
						</li>
						<li>
								<a href="/documents/networking/ipam.html">IPAM and Service Discovery</a>
						</li>
						<li>
								<a href="/documents/networking/ipv6.html">IPv6</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/documents/storage/index.html">Storage</a>
					<ul class="nav">
						<li>
								<a href="/documents/storage/architecture.html">Architecture</a>
						</li>
						<li>
								<a href="/documents/storage/configuration.html">Configuration</a>
						</li>
						<li>
								<a href="/documents/storage/containers.html">Creating a Container with a Volume</a>
						</li>
						<li>
								<a href="/documents/storage/volcli.html">Volcli Reference</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/documents/cluster/index.html">Cluster</a>
					<ul class="nav">
						<li>
								<a href="/documents/cluster/concepts.html">Concepts and Terminology</a>
						</li>
						<li>
								<a href="/documents/cluster/node-lifecycle.html">Node Lifecycle Management</a>
						</li>
					</ul>
				</li>
			</ul>
			<hr><p>
			<h3>Tutorials and Talks</h3>
				<ul class="nav docs-sidenav">
					<li>
						<a href="/documents/tutorials/index.html">Tutorials</a>
						<ul class="nav">
							<li>
									<a href="/documents/tutorials/container-101.html">Container Networking Tutorial</a>
							</li>
							<li>
									<a href="/documents/tutorials/contiv-compose.html">Policies with Networking</a>
							</li>
						</ul>
					</li>
					<li>
						<a href="/documents/demos/index.html">Demonstration Videos</a>
					</li>
					<li>
						<a href="/documents/talks/index.html">Community Talks</a>
					</li>
				</ul>
			<hr><p>
			<h3>Examples</h3>
				<ul class="nav docs-sidenav">
					<ul class="subnav">
						<li>
							<a href="/documents/samples/index.html">Docker Compose Examples</a>
						</li>
						<li>
							<a href="/documents/samples/index.html">Kubernetes Examples</a>
						</li>
						<li>
							<a href="/documents/samples/mcast.html">Multicast Examples</a>
						</li>
						<li>
							<a href="/documents/samples/nomad.html">Nomad Examples</a>
						</li>
					</ul>
				</ul>
			<hr><p>
			<h3>Reference</h3>
				<ul class="nav docs-sidenav">
					<ul class="subnav">
						<li><a href="https://godoc.org/github.com/contiv/contivmodel/client" target="_blank">Network API Reference</a><br></li>
						<li><a href="https://godoc.org/github.com/contiv/volplugin/config" target="_blank">Storage API Reference</a><br></li>
						<li><a href="https://godoc.org/github.com/contiv/cluster" target="_blank">Cluster API Reference</a><br></li>
					</ul>
				</ul>
			<hr><p>
		</div>

		</div>  
		<div id="main-content" class="col-sm-9 col-md-9 col-xs-12" role="main">
			<div class="bs-docs-section">
				
	<h1>Installing Contiv Network with Docker Swarm</h1>
<p>This page describes how to set up a Contiv cluster using Docker Swarm.</p>
<p><a name="Prerequisites"/></p>

<h2>Prerequisites</h2>

<ol>
<li>Install Ubuntu 15 or Centos 7.2 on all servers used for the Contiv cluster.
</li>
<li>Ensure that each server has at least two, and preferably three, interfaces.
</li>
<li>Choose a server that is on the management network. Run the install procedure below on this node. This <em>install node</em> manages the installation in addition to being part of your cluster.
</li>
<li>In a command shell, use the following commands to set two environment variables:
<a name="export_CLUSTER_NODE_IPS_lt_node_ips_gt_and"/><a href="#export_CLUSTER_NODE_IPS_lt_node_ips_gt_and"><code>export CLUSTER_NODE_IPS=&lt;node_ips&gt; and</code></a>export no_proxy=<node_ips>,127.0.0.1,localhost,netmaster<code>,
where</code><node_ip>` is a list of the IP addresses of all nodes in your cluster.
</li>
<li>If your servers are behind an http proxy, use the following commands to set the proxies on the install node: <a name="export_http_proxy_lt_proxy_url_gt_"/><a href="#export_http_proxy_lt_proxy_url_gt_"><code>export http_proxy=&lt;proxy url&gt;</code></a> and  <code>export https_proxy=&lt;proxy_url&gt;</code>. 
</li>
<li>Verify Python is installed on the target machines
</li>
<li>The setup scripts use the Python module <em>netaddr</em> and the Linux utility <em>bzip2</em>. If these are not installed on the machine where you are executing these steps, you must install them before proceeding. (You can use the following commands: <a name="yum_install_bzip2_pip_install_netaddr"/><a href="#yum_install_bzip2_pip_install_netaddr"><code>yum install bzip2; pip install netaddr</code></a>.)
</li>
<li>(Optional but recommeded): Enable passwordless SSH access from the installation server to all the other servers in the cluster. An example is <a href="http://www.linuxproblem.org/art_9.html">here</a>.
</li>
<li>(Optional but recommeded): Enable passwordless sudo on all servers.  An example is
<a href="http://askubuntu.com/questions/192050/how-to-run-sudo-command-with-no-password">here</a>.
</li>
<li>Make a note of the IP addresses (or DNS names) of all the servers, and of the network
interfaces on which these IP addresses are configured.
</li>
</ol>
<p><a name="Download"/></p>

<h2>Step 1: Download the Installer Script</h2>
<p>Log into the install server and download the installer script using the following command:</p>
<pre class="highlight plaintext"><code>wget https://raw.githubusercontent.com/contiv/demo/master/net/net_demo_installer
</code></pre>

<h2>Step 2: Create the Configuration File</h2>
<p>Create the configuration file, <code>cfg.yml</code>, and provide connection information for each server.</p>
<p>In the configuration file, <code>CONNECTION_INFO</code> is a mandatory section that provides access 
information for all server nodes in the setup.</p>
<p>For every server in the setup, provide the IP/DNS and the control, data interface:</p>
<pre class="highlight plaintext"><code>    CONNECTION_INFO:
        &lt;server1-ip-or-dns&gt;:
            control: &lt;interface on which control protocols can interact&gt;
            data: &lt;interface used to send data packets&gt;
        &lt;server2-ip-or-dns&gt;:
            control: &lt;interface on which control protocols can interact&gt;
            data: &lt;interface used to send data packets&gt;
</code></pre>
<p>A sample configuration file can be found here: <a href="/extras/sample_cfg.yml">sample_cfg.yml</a>.</p>

<h2>Step 3: Run the Installer Script</h2>
<p>Set execute privileges on and run the installer script as follows:</p>
<pre class="highlight plaintext"><code>    chmod +x net_demo_installer
    ./net_demo_installer
</code></pre>
<p>set the environment variable contiv_network_version if a different version of Contiv network is needed.</p>
<pre class="highlight plaintext"><code>export contiv_network_version="v0.1-06-17-2016.08-42-14.UTC"
</code></pre>
<p>contiv network version can be obtained from: <a href="https://github.com/contiv/netplugin/releases">https://github.com/contiv/netplugin/releases</a></p>
<p>&quot;aci_gw_image&quot; specifies the docker image used for the aci-gw. This defaults to &quot;contiv/aci-gw:latest&quot;.</p>
<p>If your setup requires a different image, just set this &quot;aci_gw_image&quot; environment variable to the &quot;image-name:version&quot;.</p>
<p>e.g:</p>
<pre class="highlight plaintext"><code>export aci_gw_image="contiv/aci-gw:v2"
</code></pre>
<p>Will fetch container aci-gw of contiv user from docker hub registry with v2 tag.</p>
<p>Run net_demo_installer script.</p>
<pre class="highlight plaintext"><code>./net_demo_installer
</code></pre>
<p><em>Note</em>: To restart the services already deployed, run the installer with -r option. This ensures that the services are restarted in a clean state.</p>
<pre class="highlight plaintext"><code>./net_demo_installer -r
</code></pre>

<ul>
<li>The installer script requests username and password if passwordless ssh is not set during the installation.
</li>
<li>Running the installer with &#39;-c&#39; (&quot;clean&quot;) removes any files that are auto-generated by the script.
</li>
</ul>
<p>The installer script performs the following actions:
- Verifies that a supported operating system is installed on the servers.
- Verifies network access to the servers. 
- Creates the Ansible inventory file.
- Sets server provisioning variables that determine the installation mode.
- Runs the Ansible playbook which installs necessary packages and starts the services.</p>

<h2>What to Do Next</h2>
<p>Use the Contiv <code>netctl</code> commands are used to create and manipulate networks, endpoint groups, and policies.</p>
<p>See the small-scale Vagrant demo <a href="/documents/gettingStarted/networking/swarm.html">here</a> to get started.</p>
<p>See the <a href="/documents/tutorials/">Tutorials</a> section for extended examples of setting up policy-based networks.</p>
<p>See the <a href="/documents/samples/">Examples</a> section for details on using <code>netctl</code> to explore various features of Contiv networking.</p>

<h2>Troubleshooting</h2>
<p>Current limitations of the script include the following:</p>

<ul>
<li>The installer script must run from one of the server nodes in the cluster. 
</li>
<li>Connections to the servers must be on the default ssh port.
</li>
<li>The default username used is the local hostname.
</li>
</ul>
<p>The script generates many files for bookkeeping during the installation procedure.
These files can be found under <code>.gen</code> folder in your installer directory.
To remove these files and start from a clean slate, use the <code>-c</code> option as follows:</p>
<pre class="highlight plaintext"><code>        ./net_demo_installer -c
</code></pre>
<p>With this option, the script lists the files to remove and prompt you for confirmation to proceed.</p>
<p>If you find any other issues or have suggestions for improvement, please feel free to suggest or contribute.</p>


			</div>
		</div>
	</div>
</div>